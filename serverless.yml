service: siatech-kioscos-layer
frameworkVersion: '^3.40.0'

provider:
  name: aws
  runtime: nodejs18.x         # solo referencia; la capa vale para varios
  region: us-east-2
  stage: ${opt:stage, 'dev'}

  # Bucket estable (se crea si no existe) donde Serverless sube el .zip
  deploymentBucket:
    name: siatech-layer-artifacts-${self:provider.stage}
    serverSideEncryption: AES256
    skipPolicySetup: true

layers:
  NodeModules:
    path: node-layer               # â†³ Serverless ZIPea todo esto
    compatibleRuntimes: [nodejs18.x]
    description: "Node.js shared deps for kioscos"
  PythonPackages:
    path: python-layer
    compatibleRuntimes: [python3.11]
    description: "Python shared deps for kioscos"

resources:
  Resources:
    DeploymentArtifactsBucket:
      Type: AWS::S3::Bucket
      DeletionPolicy: Retain
      Properties:
        BucketName: siatech-layer-artifacts-${self:provider.stage}
        VersioningConfiguration: { Status: Enabled }
        PublicAccessBlockConfiguration:
          BlockPublicAcls:  true
          BlockPublicPolicy: true
          IgnorePublicAcls: true
          RestrictPublicBuckets: true
#run